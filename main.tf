terraform {
  required_providers {
    google = {
      source  = "hashicorp/aws"
      version = "~> 4.6.0"
    }
    random = { source = "hashicorp/random" }
  }
}

provider "aws" {
  region = "eu-west-1"
}

data "aws_vpc" "this" {
  default = true
}

data "aws_security_group" "this" {
  name   = "default"
  vpc_id = data.aws_vpc.this.id
}

data "aws_subnet_ids" "this" {
  vpc_id = data.aws_vpc.this.id
}


resource "random_pet" "this" {}

module "my_workerpool" {
  source = "github.com/spacelift-io/terraform-aws-spacelift-workerpool-on-ec2?ref=e954914020a5e1a561038cba27bb9d06438deba6"

  configuration = <<-EOT
    export SPACELIFT_TOKEN="eyJicm9rZXIiOnsiZW5kcG9pbnQiOiJhM2VsZjJnZGt4M3RnYS1hdHMuaW90LmV1LWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwicHVibGlzaF9jaGFubmVsX2Zvcm1hdCI6InNwYWNlbGlmdC93cml0ZW9ubHkvMDFHSlFKQUZHOU5SSEtaOEI5QTNOTVlGMFEvJXMiLCJzdWJzY3JpYmVfY2hhbm5lbF9mb3JtYXQiOiJzcGFjZWxpZnQvcmVhZG9ubHkvMDFHSlFKQUZHOU5SSEtaOEI5QTNOTVlGMFEvJXMifSwicG9vbF9jZXJ0IjoiLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tXG5NSUlFcXpDQ0E1T2dBd0lCQWdJVWFmNGU4eUZ0Vkg2SjJEV0ZhS2hzUi9mZkFrVXdEUVlKS29aSWh2Y05BUUVMXG5CUUF3VFRGTE1Fa0dBMVVFQ3d4Q1FXMWhlbTl1SUZkbFlpQlRaWEoyYVdObGN5QlBQVUZ0WVhwdmJpNWpiMjBnXG5TVzVqTGlCTVBWTmxZWFIwYkdVZ1UxUTlWMkZ6YUdsdVozUnZiaUJEUFZWVE1CNFhEVEl5TVRFeU5URTBNVFF3XG5ORm9YRFRRNU1USXpNVEl6TlRrMU9Wb3djREVMTUFrR0ExVUVCaE1DVUd3eEZEQVNCZ05WQkFnTUMwMWhlbTkzXG5hV1ZqYTJsbE1ROHdEUVlEVlFRSERBWlhZWEp6WVhjeEVqQVFCZ05WQkFvTUNWTndZV05sYkdsbWRERW1NQ1FHXG5DU3FHU0liM0RRRUpBUllYYTNKNmVYTjZkRzltYmtCemNHRmpaV3hwWm5RdWFXOHdnZ0lpTUEwR0NTcUdTSWIzXG5EUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUURGUlNQOXFlQjlIUE4rM2xBeFE4OFB6ajRIMlZ3OFI3RXBzYXJCXG5lbG9JdElYYi9QRGU2b1kzUG0xU3VyNTBnLzZlM1ZCZkNzd2lEZVJ5dS92UktqZzhNRnR0NHh4dFhtUG5NRDRHXG5CaEE2NHV1ajhtWnR0V0kwVzJobTVObjRIR0pMZGZCd2o4eXZTeURQVUlZaXFmZDFubGFDWkQycXIxSDZoaHk4XG52MmljYjhGajBtUUpGTVVyYjhrZXVWdnI4ZkE3MnZ6b1IxeU9qcVZLcGRUOTF0WEhpSmtMZTNmTmU4SGZJaVpBXG5OemdIYnhpeG9QUGw0Nmovcy8zTzVBd0tPNHFjUEpGU2NQU2t5QnQycUluZFBIRW5rYTZBUklKQWNqVjFtMVQ5XG5nVFFCTUJwNit4TE5jVHdQVlFUSUo5cmVxVHFiVXV3SXovMW15UU1aRS9YWUtwYTZWZmpEUE9oTk8zMVAxL08wXG4zb1FpUDZHU3lyTHkzR3gvMzRxS1ArV2ZBc25wUHNVUm1tZEVOS1EyUTNsQWg2L1dpeW5NZ3NaSE14aUo5bWd0XG5kbzNxVC9OUEpsWnoyMFRMdVo3QmJ4Ykc1SnprWStJVTlhVE9sK01BVzBvbXdrZVJzYlJZZ0R2Y2MraHc5TElpXG5RZWNJWkdqQzhtN2NvdEsreGJCUWgxMFRqNUhYbmxoM0hpZUlEWjN1MjA4ZHdRR3YrRDJReWlPbnZmdGxNMlF3XG4vOGJIY0NTWTN3ZDBDSmVxZnZnU3lRYm5ueWxGYW1DQlora2dPQkZzT0JyOHFzcXlkMEdVdXNxVjZ5SUpyUWV5XG5aQUJFVGdsSXgrS0dBQ25tOGk0aTdveTBzcEJUeVJGQzllZ2dIWXdwRTFBdWZUMENBaTVQNFVLdUpRdXozRVFBXG43L25BK1FJREFRQUJvMkF3WGpBZkJnTlZIU01FR0RBV2dCUzlZOFY1R1JjclNmNVlDYkF3VGRCZXdBc0ZvREFkXG5CZ05WSFE0RUZnUVVHSk83UU5IeU9wRmllV2x3bXVqa21MbWVlL0F3REFZRFZSMFRBUUgvQkFJd0FEQU9CZ05WXG5IUThCQWY4RUJBTUNCNEF3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUh6WERuejM5b1phNzFWNk9MTDNCMk5ZXG5WVEdMSThKNlhMUnNocmdiQlNyaXpld1pKbnNyOWVVd3NkQ2lIaFdEZU52eG5WKytXT1pWVmhEdEhGOTVjMDdiXG5lbjBibWZpYnRLTDJ1UU0zWjBCTXlyeFZKdW5ITjBZd3BLVERCS01CZFBsdGRpS1EvSVU4V1E0aFRpOFFMU3luXG5pKzQzM2EzS2FUS0VKeWtjNFBwVUwvd2t4Rk1hOVhuSGd6ZWNmbGVsV3NWTTU4dTVPSGg2cWtDYWNqTWIxOGtBXG50L3FmSzV5eWVwVGlhTE9kUWg1dWlTYVN5bzRNME42UkxuTWRGZlpYRSt3UnkySDJPQkY4NkFYejdEdTFTR2xYXG53REpXQ1F2NXJPT1gvbzMvd3NIeHJBRDdnRUM5MkxSc1BqVW9JVnlrU3hlTm9DdTVJL2p3bkh5cStEWW9DM009XG4tLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tXG4iLCJ3b3JrZXJfcG9vbF91bGlkIjoiMDFHSlFKQUZHOU5SSEtaOEI5QTNOTVlGMFEifQ=="
    export SPACELIFT_POOL_PRIVATE_KEY="LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRZ0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1N3d2dna29BZ0VBQW9JQ0FRREZSU1A5cWVCOUhQTisKM2xBeFE4OFB6ajRIMlZ3OFI3RXBzYXJCZWxvSXRJWGIvUERlNm9ZM1BtMVN1cjUwZy82ZTNWQmZDc3dpRGVSeQp1L3ZSS2pnOE1GdHQ0eHh0WG1Qbk1ENEdCaEE2NHV1ajhtWnR0V0kwVzJobTVObjRIR0pMZGZCd2o4eXZTeURQClVJWWlxZmQxbmxhQ1pEMnFyMUg2aGh5OHYyaWNiOEZqMG1RSkZNVXJiOGtldVZ2cjhmQTcydnpvUjF5T2pxVksKcGRUOTF0WEhpSmtMZTNmTmU4SGZJaVpBTnpnSGJ4aXhvUFBsNDZqL3MvM081QXdLTzRxY1BKRlNjUFNreUJ0MgpxSW5kUEhFbmthNkFSSUpBY2pWMW0xVDlnVFFCTUJwNit4TE5jVHdQVlFUSUo5cmVxVHFiVXV3SXovMW15UU1aCkUvWFlLcGE2VmZqRFBPaE5PMzFQMS9PMDNvUWlQNkdTeXJMeTNHeC8zNHFLUCtXZkFzbnBQc1VSbW1kRU5LUTIKUTNsQWg2L1dpeW5NZ3NaSE14aUo5bWd0ZG8zcVQvTlBKbFp6MjBUTHVaN0JieGJHNUp6a1krSVU5YVRPbCtNQQpXMG9td2tlUnNiUllnRHZjYytodzlMSWlRZWNJWkdqQzhtN2NvdEsreGJCUWgxMFRqNUhYbmxoM0hpZUlEWjN1CjIwOGR3UUd2K0QyUXlpT252ZnRsTTJRdy84YkhjQ1NZM3dkMENKZXFmdmdTeVFibm55bEZhbUNCWitrZ09CRnMKT0JyOHFzcXlkMEdVdXNxVjZ5SUpyUWV5WkFCRVRnbEl4K0tHQUNubThpNGk3b3kwc3BCVHlSRkM5ZWdnSFl3cApFMUF1ZlQwQ0FpNVA0VUt1SlF1ejNFUUE3L25BK1FJREFRQUJBb0lDQURHNUhyeEdnRzRveVB0V2YvSWEvR3NvCmVod3lYbnhYT2NHZnBjSEUzRUxMZGQ0Z1lIcGZ0TnJoNGw1eThhU2V6S1F3ZHB5dU5RdjBZbnZGQkZFUmlrRXAKa3pJY2g4TE5ndkw0QnZvdnR4R1F0d0tKQytabFRNNlRwN29mdncwNTRsRFE5bno0MGdmeE1PRHdsQTdTdHF3dgo3L0JINGY5TzE2UUUvK05YZjcvR3I0RkF1N1JLUnZTTzVhdlgzdUtYQmcyZ1FoVXVQNWN6UDFpVWVoNU5jMjhxCjhDQ2p5MnZBNFBva09tMy9QU0Vxa0pmZFVQekdLSWZqVDN0Qm9nTkdSTWJpd1dKOVZEemdyNE4yTWVIUTVWaXEKOE1nbC9JclAvc2VaRXBBZmJBTk1vN0FSN3doWG5XTGo5Q09iWUNDMW1TOGpkSms0QzlCSHBIOUN0N24zNml1MgpCWVlYN1lLT2xHQmEzZDZJMEtOOFlJWDJveC9HUjBHMWNjTzhEQlNYN2dmSEhyeCt4bDlaMXZpUDFMazlueG5iCnhzamFua1pibjVWMlpvakVPZ2pGSGNKV0ViRC9vaml6MHBmRVFGanl3Z3RBZU02SUZaRzI1b0ZYaFBuOHdlOEEKeGFYM2xEbWJQMnBJbG16d2hFWmR3VHpXNkxRSHNrczE5UllxK0xuNVZDazUrOUV1SmhRTWo0WEhBZGszMEF3SQpNdTVtVUFGTGN4Y3F2bTBpZ3pTL3hMNjJSZHB0dURzR3ZKaXE3bFpGcjh1ZUxEaml6TnRoT3N0enZORGpIZ00wClZCeFlsMzJzaFZCZEl6cHNLZGpraG5jaUxham1Xc0djeWsyMzZpbm95NEVHS0VONTVpNnZEUFJURzRLclNzT2YKRTd4cE1qNGR4SUVISmVDUGltNkJBb0lCQVFEdzlBeVduTEd1emoxN3lRSW1XQ2E2STMzYzQ0U25nQytjelczawpkbFBVYm1TV2N5UGRYU2o2QjRhV05oVEROOTZ2K0lsWngwWDR5cGNsbFRnTHhmNlhlZjIwTG52SDk5amN2TDBECkZZb1puc0JtdDQ3aHZZUnBmOHFyYkdpU3NFbE42RE9MbncrM0pyL0FKbEpMOVJ6N2NqRGlPbXA3YlZlL3VnS1kKUzBzZnVVZGVXOXU2T0REc20yVDZNYmRmU2hjQUF0WndFWUIzdklJQTVuRjhEQlBvcWVUMkhoOU03ak5ZTy9NMgpKU0ZyMVh2NGs0M09IUUFEd1FLU0tPV1NoOW5iVEV0VDZzelhIM0hpVUJCZllpamt5Q29VN0x0NGVyYWc2d3VWCmpNVWk1a0gySEZmSDRFNUFkeHN3UHlUeTlOMUFSVUxuZEk5UXdXSnBoRi9NaFZ3eEFvSUJBUURSbHNJZ1IrRjQKMVRZcnFDQ0p5U0xTaDR1YTFocDc2bkJFYTZ0dVpBeFczNDlOUS9ESWtrOXJxK256SXFRWlE3d2RzbWc1TkV6bgpGYmtTc0FwbmQ3VHZiMFRWY21yRUV5OWRGbWVQZ2VTY2xCT3RnbERnanpEU0FUTjBlYjhXdi85MnpYTStrQXJuCnV2Vkk3ZnJIMmttNTVXL1QxWjVzYW9TYWo2bnd3cU9aVklTUUQ0YlRjeFJ6R3hUQ0RHMUlnN01RTkUyQ3J0NUcKYVAvbW0zRmMwMlppVHlIazE2YzNZZHMzeWFsbURGT2c2RjdPM1VqcHdJQUI0aGVnMDlCMWhvU1QyU0lXL1BLQQpsWjRmams3eVI3VnUzOVZIUWMzZ2tSUDI0aEgzZWg2SXZ3Smc1RitMNnlRRzFteC9RRDdhblBZd3hjVncrQ1R2ClhyYzliSDJzbHlkSkFvSUJBUURRZmh3MlpyZkl6bVNkSzcxVWVJcHFIalBXWW5oeWg1U3JWWVoxWFg0RUh0R2kKN1ZablFTa24wRU5BenVNQVdPT3oySmJndkhGcmFjR0huNnF6WlV0NnZ2QXNiTnhtbDZ0cXRWWEh5V2VKNjdnSQpLV1RWS0N2ZkxkaXNwRTJJUUVudHc3SjJhZGdyWHJnbENBUEYvZjVxQk5FUHNBUmJjSzJ4Rkw4U0VIU2NxckY2CmtIbDhsUXFnY1lYYWlCSm52YkJSTGlObkxYM0FIYmxRRmhhMGc2N21iN3ZTeXhYQ2Q0cXVHcEhFbERSckhucjcKQ0pKM2V0aDhaeEpXYmxUWGlmMlVxRnUxN1VINkV4ZDBBRnRxYllGOUZVWjBmTE5xK0tQMmNldkFKK0tjNUNqSApVSmNVT0o3OVlSS0JtT0hiNk0xWnc1UzB1a01ZV1gxU1dGeWNsL2pCQW9JQkFFdTdmdi90R1ZMeEwvYk1kSjExCkdXa2JZMTJhbWMxRzVEUkU5NWdXL01Kelc3T2VwaVhEZ0lFMmlIMjdlYkpMWUhFV28wUndXbzF4c3dOR3F5dkIKL0pZOERaSlhHcThwQTRkT2JqTlR5MGlzMVFOd1FFczBVbjYvd2xrSEdQNWVlQy8wZ3YwTFRYVjRmK05QWXJ2TwphNitKY1VRSlA0cUxYc2ordW5odHpIRytNWHhncitZK0FoaXBvM0dPemZwUzVHUXBrZ3h6cFl1cHF6WW4ydW1nCjFiRVdTUGdJMkxwUldNWXF6MVE1aGdweGpMaVJDeVN6MDAxYTVoRE9HTmd1dUQ4NFNYSW5DblZlR3RucU1TcW8Kc0syVW9kdHlzcksvbVlndkhqRGZacU1nNmZvYTYwK0NzdXpwbENEVEZTTW5ibW9uUEhYYXBIWCtNcFkyV3A3LwpxMGtDZ2dFQWF0TmxRV21ZQWprVzE2QWR4ckVQNXlHQ3pmcU9yN2FuYUNTbHRhb3ZTazVVRHk1d3RCbzJPTGF3ClQzYjVCM0lEdkg1WWhvVzZXVkx0R0xIQ3VrbG1zL0tqejJXL2htUHJkZlhRMnZrSmwwcTdZVzdoVEhndkt2NnUKTTlsRHNOSG1Eb2JDTGhtdXhmK3N3RFhXR1RiZTBTZzZNR01JZzhaalBNZjRVclErWGdIZFJ5RXNoUkEwelBhRApLaDBRM2R1Um1ZcVJ6S1cybVVyam56cVVRV2RYY1FzOFZkNGt4cTFJY3V5N0RtYm02aGlmaTlGb2ZyUFBESktSCkhMdUVTdGZiY0pkdmJvSGhsM0h0VUFHT055VCtydVNYTlcvQ0liN0Nwc0YrVVVxUng4SE5HUk1nb00xS0c1Sy8KTU5xYnRCdUtpLytuNk1wcFZFR3pZZnNUTllCaXVBPT0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo="
  EOT

  max_size          = 2
  ami_id            = "ami-0ecc1e917fcb34066"
  worker_pool_id    = random_pet.this.id
  security_groups = [data.aws_security_group.this.id]
  vpc_subnets     = data.aws_subnet_ids.this.ids
}